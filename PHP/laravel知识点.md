# laravel 框架

## laravel服务容器实现原理

### 什么是服务容器
> Laravel 服务容器是一个用于管理类依赖以及实现依赖注入的强有力工具

laravel框架就是使用服务容器实现**控制反转**和**依赖注入**

#### 零配置解决方案
如果一个类没有依赖项或只依赖于其他**具体类**（而不是接口），则不需要指定容器如何解析该类

#### 绑定
首先，如果你编写了一个**实现接口的类**，并希望在路由或类的构造函数上**键入该接口的提示**，则必须 **告诉容器如何解析该接口**。第二，如果你正在 编写一个 Laravel 包 计划与其他 Laravel 开发人员共享，那么你可能需要将包的服务绑定到容器中

### 什么是控制反转（LoC）和依赖注入（DI）


> 控制反转 就是把**创建对象的控制权**进行转移，由自身控制交给容器控制。
>
> 依赖注入 就是在帮容器实现在运行状态为对象提供依赖的资源

### Laravel容易依赖注入的实现原理

主要利用了 **闭包** 和 **反射**

> 闭包（匿名函数）：
匿名函数（Anonymous functions），也叫闭包函数（closures），允许 临时创建一个没有指定名称的函数
>
> 反射：PHP 5 以上版本具有完整的反射 API，添加了对类、接口、函数、方法和扩展进行反向工程的能力。 此外，反射 API 提供了方法来取出函数、类和方法中的文档注释

如果bind的是一个闭包，那么依赖注入时，调用的就是这个闭包。如果没有进行bind或bind的就是类名，那么会通过反射找到类的创建函数，生成闭包创建这个类对象，如果改类也有依赖以此类推。


上面示例中我们先实例化容器类，然后使用 bind() 方法 绑定接口和 生成相应的实例的闭包函数。然后使用 make() 函数生成实例对象，在 make() 中会调用 isBuildable($concrete, $abstract) 来判断 给定的服务实体（$concrete 参数）是否可以创建，可以创建 就会调用 build($concrete) 函数 ，build($concrete) 函数会判断传的参数是**闭包**还是**具体类名** ，如果是闭包则直接运行，如果是具体类名的话，则**通过反射获取该类的构造函数所需的依赖**，完成实例化。


参考文章：
> [laravel 10 中文文档](https://learnku.com/docs/laravel/10.x/container/14842)
> https://learnku.com/articles/4977/laravel-service-container-implementation-principle#029336